<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cible PHP</title>
  </head>
  <body>
    <?php

        $ville = $_POST['ville'];
        $var = 'Rouen';
        $var2 = 'Paris';
        $url = 'https://maps.googleapis.com/maps/api/distancematrix/json?origins=' . $ville . '&destinations=' . $var .'&mode=driving&language=fr-FR';
        $url2 = 'https://maps.googleapis.com/maps/api/distancematrix/json?origins=' . $ville . '&destinations=' . $var2 .'&mode=driving&language=fr-FR';

        $json = json_decode(file_get_contents($url), true);
        $json2 = json_decode(file_get_contents($url2), true);

        $distanceRouen = $json['rows'][0]['elements'][0]['distance']['value'];
        $distanceParis = $json2['rows'][0]['elements'][0]['distance']['value'];

      //  var_dump($distanceParis);
     //   var_dump($distanceRouen);

    $rouen = array (
    "5" => "3.06",
    "10" => "3.39",
    "15" => "3.85",
    "20" => "4.18",
    "25" => "4.53",
    "30" => "4.87",
    "35" => "5.21",
    "40" => "5.54",
    "45" => "5.87",
    "50" => "6.23",
    "60" => "6.85",
    "70" => "7.49",
    "80" => "8.12",
    "90" => "9.45",
    "100" => "10.13",
    "110" => "10.41",
    "120" => "10.79",
    "130" => "11.22",
    "140" => "11.63",
    "150" => "12.05",
    "160" => "11.54",
    "170" => "11.9",
    "180" => "12.29",
    "190" => "12.67",
    "200" => "13.05",
    "210" => "13.43",
    "220" => "13.79",
    "230" => "14.18",
    "240" => "14.55",
    "250" => "14.95",
    "260" => "15.3",
    "270" => "15.69",
    "280" => "16.07",
    "290" => "16.45",
    "300" => "16.83",
    "310" => "17.2",
    "320" => "17.57",
    "330" => "17.95",
    "340" => "18.34",
    "350" => "18.71",
    "360" => "19.22",
    "370" => "19.72",
    "380" => "20.25",
    "390" => "20.75",
    "400" => "21.25",
    "410" => "21.76",
    "420" => "22.28",
    "430" => "22.78",
    "440" => "23.29",
    "450" => "23.79",
    "460" => "24.31",
    "470" => "24.82",
    "480" => "25.32",
    "490" => "25.84",
    "500" => "26.35",
    "510" => "26.84",
    "520" => "27.36",
    "530" => "27.87",
    "540" => "28.37",
    "550" => "28.9",
    "560" => "29.39",
    "570" => "29.9",
    "580" => "30.42",
    "590" => "30.92",
    "600" => "31.42",
    "610" => "31.93",
    "620" => "32.45",
    "630" => "32.95",
    "640" => "33.47",
    "650" => "33.99",
    "660" => "34.47",
    "670" => "34.98",
    "680" => "35.5",
    "690" => "36",
    "700" => "36.51");

    $paris = array (
        "5" => "3.45",
        "10" => "3.82",
        "15" => "4.33",
        "20" => "4.72",
        "25" => "5.12",
        "30" => "5.49",
        "35" => "5.89",
        "40" => "6.25",
        "45" => "6.63",
        "50" => "7.02",
        "60" => "7.73",
        "70" => "8.45",
        "80" => "9.16",
        "90" => "9.88",
        "100" => "10.59",
        "110" => "10.88",
        "120" => "11.29",
        "130" => "11.73",
        "140" => "12.16",
        "150" => "12.58",
        "160" => "13",
        "170" => "13.42",
        "180" => "13.85",
        "190" => "14.28",
        "200" => "14.71",
        "210" => "15.15",
        "220" => "15.54",
        "230" => "15.99",
        "240" => "16.41",
        "250" => "16.85",
        "260" => "17.26",
        "270" => "17.69",
        "280" => "18.12",
        "290" => "18.55",
        "300" => "18.98",
        "310" => "19.39",
        "320" => "19.81",
        "330" => "20.24",
        "340" => "20.67",
        "350" => "21.1",
        "360" => "21.67",
        "370" => "22.24",
        "380" => "22.84",
        "390" => "23.39",
        "400" => "23.96",
        "410" => "24.53",
        "420" => "25.11",
        "430" => "25.69",
        "440" => "26.25",
        "450" => "26.83",
        "460" => "27.41",
        "470" => "27.98",
        "480" => "28.56",
        "490" => "29.13",
        "500" => "29.7",
        "510" => "30.26",
        "520" => "30.84",
        "530" => "31.43",
        "540" => "31.98",
        "550" => "29.39",
        "560" => "29.9",
        "570" => "30.42",
        "580" => "30.92",
        "590" => "31.42",
        "600" => "31.93",
        "610" => "32.45",
        "620" => "32.97",
        "630" => "33.47",
        "640" => "33.99",
        "650" => "34.47",
        "660" => "34.98",
        "670" => "35.5",
        "680" => "36",
        "690" => "36.51");

        $fraisdeport = '';
        if ($distanceRouen < $distanceParis) {
          //rouen
          $distanceRouen = round($distanceRouen/1000);
          foreach ($rouen as $key => $value){
            if ($distanceRouen < $key){
              $fraisdeport = $value;
              break;
            }
          }
        }
        else {
          //Paris
          $distanceParis = round($distanceParis/1000);
          foreach ($paris as $key => $value) {
            if ($distanceParis < $key){
              $fraisdeport = $value;
              break;
            }
          }
        }

    //echo $fraisdeport;
          /*foreach ($rouen as $value) {
            $value = $value;
              echo $value . '<br/>';*/

?>
<p>Le résultat du prix de transport est de <?php echo $fraisdeport; ?> €/t</p>
<p>Pour changer de ville, <a href="formulaire.php">cliquez ici</a> pour revenir à la page formulaire.php.</p>
  </body>
</html>
